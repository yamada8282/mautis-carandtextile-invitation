<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weave Pattern Lab v5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #f0f0f0;
            /* アプリ全体の背景も少し明るく */
            color: #111;
            /* 文字色を黒に */
            display: flex;
            height: 100vh;
        }

        .controls {
            width: 320px;
            padding: 20px;
            background: #fff;
            /* コントロールパネルも白系に */
            overflow-y: auto;
            border-right: 1px solid #ddd;
        }

        h1 {
            font-size: 11px;
            letter-spacing: 0.2em;
            color: #999;
            margin-bottom: 5px;
        }

        h2 {
            font-size: 16px;
            margin-bottom: 20px;
            color: #000;
        }

        .section {
            font-size: 9px;
            color: #666;
            letter-spacing: 0.15em;
            margin: 20px 0 12px 0;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .control {
            margin-bottom: 12px;
        }

        .control label {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #888;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .control .val {
            color: #000;
            font-weight: 600;
        }

        .control input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            background: #eee;
            height: 3px;
            border-radius: 2px;
        }

        .control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #000;
            border-radius: 50%;
            cursor: pointer;
        }

        .control select {
            width: 100%;
            padding: 8px;
            background: #f9f9f9;
            color: #000;
            border: 1px solid #eee;
            font-size: 11px;
        }

        button {
            width: 100%;
            padding: 10px;
            background: #000;
            color: #fff;
            border: none;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 6px;
            letter-spacing: 0.1em;
        }

        button:hover {
            background: #333;
        }

        .btn-alt {
            background: #eee;
            color: #000;
        }

        .btn-alt:hover {
            background: #ddd;
        }

        .canvas-wrap {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            background: #e0e0e0;
        }

        canvas {
            background: #fff;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="controls">
        <h1>WEAVE PATTERN LAB</h1>
        <h2>織り目実験室 v5</h2>

        <div class="section">WEAVE STYLE</div>
        <div class="control">
            <select id="style">
                <option value="classic">Classic (クラシック)</option>
                <option value="loose">Loose (ルーズ)</option>
                <option value="tight">Tight (タイト)</option>
                <option value="organic">Organic (有機的)</option>
                <option value="glitch">Glitch (グリッチ)</option>
                <option value="minimal">Minimal (ミニマル)</option>
                <option value="dense">Dense (高密度)</option>
                <option value="wave">Wave (波)</option>
            </select>
        </div>

        <div class="section">WARP (縦糸)</div>
        <div class="control">
            <label>Amplitude <span class="val" id="warpAmpVal">0.50</span></label>
            <input type="range" id="warpAmp" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="control">
            <label>Frequency <span class="val" id="warpFreqVal">0.50</span></label>
            <input type="range" id="warpFreq" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="control">
            <label>Spacing <span class="val" id="warpSpaceVal">0.50</span></label>
            <input type="range" id="warpSpace" min="0" max="1" step="0.01" value="0.5">
        </div>

        <div class="section">WEFT (横糸)</div>
        <div class="control">
            <label>Amplitude <span class="val" id="weftAmpVal">0.50</span></label>
            <input type="range" id="weftAmp" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="control">
            <label>Frequency <span class="val" id="weftFreqVal">0.50</span></label>
            <input type="range" id="weftFreq" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="control">
            <label>Spacing <span class="val" id="weftSpaceVal">0.50</span></label>
            <input type="range" id="weftSpace" min="0" max="1" step="0.01" value="0.5">
        </div>

        <div class="section">TEXTURE</div>
        <div class="control">
            <label>Noise <span class="val" id="noiseVal">0.20</span></label>
            <input type="range" id="noise" min="0" max="1" step="0.01" value="0.2">
        </div>
        <div class="control">
            <label>Line Weight <span class="val" id="weightVal">0.30</span></label>
            <input type="range" id="weight" min="0" max="1" step="0.01" value="0.3">
        </div>
        <!-- Opacity削除 -->

        <div class="section">COLOR PALETTE (WHITE BG)</div>
        <div class="control">
            <select id="palette">
                <option value="bw_std">Standard (Black)</option>
                <option value="swiss">Swiss (Red/Black)</option>
                <option value="bauhaus">Bauhaus (Blue/Yellow)</option>
                <option value="pop">Pop (Pink/Cyan)</option>
                <option value="retro">Retro (Orange/Teal)</option>
                <option value="navy">Navy (Navy/Gold)</option>
                <option value="forest">Forest (Green/Brown)</option>
                <option value="mono_grey">Modern Grey (Grey/Black)</option>
            </select>
        </div>

        <div class="section">ACTIONS</div>
        <button id="regen">REGENERATE</button>
        <button id="rand" class="btn-alt">RANDOM PARAMS</button>
        <button id="randStyle" class="btn-alt">RANDOM STYLE</button>
    </div>

    <div class="canvas-wrap">
        <!-- 2048px 高解像度 -->
        <canvas id="c" width="2048" height="2048"
            style="max-width: 100%; max-height: 100%; object-fit: contain;"></canvas>
    </div>

    <script>
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        const W = c.width, H = c.height;

        const $ = id => document.getElementById(id);

        // カラーパレット定義 (全て白背景BG: #ffffff)
        const palettes = {
            bw_std: { bg: '#ffffff', warp: '#000000', weft: '#000000' },
            swiss: { bg: '#ffffff', warp: '#e60012', weft: '#111111' },
            bauhaus: { bg: '#ffffff', warp: '#00549f', weft: '#fecb00' },
            pop: { bg: '#ffffff', warp: '#ff0066', weft: '#00ccff' },
            retro: { bg: '#ffffff', warp: '#ff4500', weft: '#008080' },
            navy: { bg: '#ffffff', warp: '#001133', weft: '#d4af37' },
            forest: { bg: '#ffffff', warp: '#225522', weft: '#8b4513' },
            mono_grey: { bg: '#ffffff', warp: '#444444', weft: '#aaaaaa' }
        };

        // スライダー群 (Opacity削除)
        const sliders = ['warpAmp', 'warpFreq', 'warpSpace', 'weftAmp', 'weftFreq', 'weftSpace', 'noise', 'weight'];
        const valEls = {};
        sliders.forEach(id => {
            valEls[id] = $(id + 'Val');
            $(id).oninput = () => {
                const v = $(id).value;
                valEls[id].textContent = parseFloat(v).toFixed(2);
                generate();
            };
        });

        $('style').onchange = generate;
        $('palette').onchange = generate;
        $('regen').onclick = generate;

        $('rand').onclick = () => {
            const styles = ['classic', 'loose', 'tight', 'organic', 'glitch', 'minimal', 'dense', 'wave'];
            $('style').value = styles[Math.floor(Math.random() * styles.length)];
            sliders.forEach(id => {
                $(id).value = Math.random();
                valEls[id].textContent = parseFloat($(id).value).toFixed(2);
            });
            generate();
        };

        $('randStyle').onclick = () => {
            // Opacity なしのプリセット
            const presets = {
                classic: { warpAmp: 0.3, warpFreq: 0.4, warpSpace: 0.5, weftAmp: 0.3, weftFreq: 0.4, weftSpace: 0.5, noise: 0.1, weight: 0.3 },
                loose: { warpAmp: 0.6, warpFreq: 0.2, warpSpace: 0.3, weftAmp: 0.5, weftFreq: 0.2, weftSpace: 0.3, noise: 0.2, weight: 0.4 },
                tight: { warpAmp: 0.1, warpFreq: 0.6, warpSpace: 0.8, weftAmp: 0.1, weftFreq: 0.6, weftSpace: 0.8, noise: 0.05, weight: 0.2 },
                organic: { warpAmp: 0.7, warpFreq: 0.3, warpSpace: 0.5, weftAmp: 0.8, weftFreq: 0.25, weftSpace: 0.5, noise: 0.4, weight: 0.35 },
                glitch: { warpAmp: 0.5, warpFreq: 0.5, warpSpace: 0.5, weftAmp: 0.5, weftFreq: 0.5, weftSpace: 0.5, noise: 0.8, weight: 0.3 },
                minimal: { warpAmp: 0.05, warpFreq: 0.1, warpSpace: 0.2, weftAmp: 0.05, weftFreq: 0.1, weftSpace: 0.2, noise: 0, weight: 0.15 },
                dense: { warpAmp: 0.2, warpFreq: 0.7, warpSpace: 0.9, weftAmp: 0.2, weftFreq: 0.7, weftSpace: 0.9, noise: 0.1, weight: 0.1 },
                wave: { warpAmp: 0.9, warpFreq: 0.5, warpSpace: 0.4, weftAmp: 0.9, weftFreq: 0.5, weftSpace: 0.4, noise: 0.15, weight: 0.4 }
            };
            const style = $('style').value;
            const p = presets[style];
            Object.keys(p).forEach(k => {
                $(k).value = p[k];
                valEls[k].textContent = parseFloat(p[k]).toFixed(2);
            });
            generate();
        };

        let warpSeed = 1;
        let weftSeed = 1;
        function warpRnd() { warpSeed = (warpSeed * 9301 + 49297) % 233280; return warpSeed / 233280; }
        function weftRnd() { weftSeed = (weftSeed * 7901 + 31337) % 233280; return weftSeed / 233280; }

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function generate() {
            warpSeed = Date.now();
            weftSeed = Date.now() + 99999;

            const pId = $('palette').value;
            const pal = palettes[pId];

            ctx.fillStyle = pal.bg;
            ctx.fillRect(0, 0, W, H);

            const d = {
                style: $('style').value,
                palette: pal,
                warpAmp: parseFloat($('warpAmp').value),
                warpFreq: parseFloat($('warpFreq').value),
                warpSpace: parseFloat($('warpSpace').value),
                weftAmp: parseFloat($('weftAmp').value),
                weftFreq: parseFloat($('weftFreq').value),
                weftSpace: parseFloat($('weftSpace').value),
                noise: parseFloat($('noise').value),
                weight: parseFloat($('weight').value)
                // opacity削除
            };

            drawWeave(d);
        }

        function drawWeave(d) {
            // パラメータをキャンバスサイズ(2048)に合わせて調整
            const warpSpacing = 6 + (1 - d.warpSpace) * 70;
            const weftSpacing = 6 + (1 - d.weftSpace) * 70;
            const warpAmp = d.warpAmp * 160;
            const weftAmp = d.weftAmp * 160;
            const warpFreq = 0.002 + d.warpFreq * 0.04;
            const weftFreq = 0.002 + d.weftFreq * 0.04;
            const lineW = 1.0 + d.weight * 25;
            const noise = d.noise;
            const alpha = 1.0; // 完全不透明固定

            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // 縦糸 (WARP)
            ctx.strokeStyle = hexToRgba(d.palette.warp, alpha);
            ctx.lineWidth = lineW;

            for (let x = warpSpacing / 2; x < W; x += warpSpacing) {
                if (warpRnd() < noise * 0.15) continue;

                ctx.beginPath();
                const phase = warpRnd() * Math.PI * 2;
                const localAmp = warpAmp * (0.6 + warpRnd() * 0.4);
                const localFreq = warpFreq * (0.7 + warpRnd() * 0.6);

                for (let y = 0; y <= H; y += 4) {
                    let wave = Math.sin(y * localFreq + phase) * localAmp;

                    if (noise > 0) {
                        wave += (warpRnd() - 0.5) * noise * 80; // 振幅調整
                    }

                    if (d.style === 'organic') {
                        wave += Math.sin(y * 0.005 + x * 0.002) * 40;
                    } else if (d.style === 'glitch') {
                        if (warpRnd() < 0.02) wave += (warpRnd() - 0.5) * 200;
                    } else if (d.style === 'wave') {
                        wave *= 1 + Math.sin(y * 0.002) * 0.5;
                    }

                    const px = x + wave;
                    y === 0 ? ctx.moveTo(px, y) : ctx.lineTo(px, y);
                }
                ctx.stroke();
            }

            // 横糸 (WEFT)
            ctx.strokeStyle = hexToRgba(d.palette.weft, alpha); // 不透明
            ctx.lineWidth = lineW * 0.85;

            for (let y = weftSpacing / 2; y < H; y += weftSpacing) {
                if (weftRnd() < noise * 0.2) continue;

                ctx.beginPath();
                const phase = weftRnd() * Math.PI * 2;
                const localAmp = weftAmp * (0.6 + weftRnd() * 0.4);
                const localFreq = weftFreq * (0.7 + weftRnd() * 0.6);

                for (let x = 0; x <= W; x += 4) {
                    let wave = Math.sin(x * localFreq + phase) * localAmp;

                    if (noise > 0) {
                        wave += (weftRnd() - 0.5) * noise * 60;
                    }

                    if (d.style === 'organic') {
                        wave += Math.cos(x * 0.005 + y * 0.002) * 30;
                    } else if (d.style === 'glitch') {
                        if (weftRnd() < 0.02) wave += (weftRnd() - 0.5) * 160;
                    } else if (d.style === 'wave') {
                        wave *= 1 + Math.cos(x * 0.002) * 0.5;
                    }

                    const py = y + wave;
                    x === 0 ? ctx.moveTo(x, py) : ctx.lineTo(x, py);
                }
                ctx.stroke();
            }

            // ビネット (白背景用に調整) - 少し弱めに
            const g = ctx.createRadialGradient(W / 2, H / 2, H * 0.4, W / 2, H / 2, H * 0.9);
            g.addColorStop(0, 'rgba(255,255,255,0)');
            g.addColorStop(1, 'rgba(255,255,255,0.7)');
            ctx.fillStyle = g;
            ctx.fillRect(0, 0, W, H);
        }

        generate();
    </script>
</body>

</html>